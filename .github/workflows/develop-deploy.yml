name: Deploy Develop Branch

on:
  push:
    branches:
      - develop

jobs:
  deploy:
    name: Deploy to Develop Path
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Deploy to Digital Ocean Spaces
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          DO_SPACES_BUCKET: ${{ vars.DO_SPACES_BUCKET }}
          DO_SPACES_ENDPOINT: ${{ vars.DO_SPACES_ENDPOINT }}
          GITHUB_REF_NAME: ${{ github.ref_name }}
          GITHUB_ACTIONS: 'true'
        run: npm run deploy

      - name: Create deployment summary
        run: |
          BASE_URL="https://${{ vars.DO_SPACES_BUCKET }}.${{ vars.DO_SPACES_ENDPOINT }}/cxone-expert-enhancements"

          echo "## 🚀 Develop Branch Deployed Successfully" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### 📦 Deployment Information" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Branch:** \`develop\`" >> $GITHUB_STEP_SUMMARY
          echo "**Deployment Path:** \`cxone-expert-enhancements/develop/\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### 🔗 Deployment URLs" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Main embed script:**" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`html" >> $GITHUB_STEP_SUMMARY
          echo "<script src=\"${BASE_URL}/develop/expert-enhancements-embed.js\"></script>" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Direct file links:**" >> $GITHUB_STEP_SUMMARY
          echo "- [expert-enhancements-embed.js](${BASE_URL}/develop/expert-enhancements-embed.js)" >> $GITHUB_STEP_SUMMARY
          echo "- [expert-enhancements-core.js](${BASE_URL}/develop/expert-enhancements-core.js)" >> $GITHUB_STEP_SUMMARY
          echo "- [expert-enhancements-core.css](${BASE_URL}/develop/expert-enhancements-core.css)" >> $GITHUB_STEP_SUMMARY
          echo "- [expert-enhancements-css.js](${BASE_URL}/develop/expert-enhancements-css.js)" >> $GITHUB_STEP_SUMMARY
          echo "- [expert-enhancements-css.css](${BASE_URL}/develop/expert-enhancements-css.css)" >> $GITHUB_STEP_SUMMARY
          echo "- [expert-enhancements-html.js](${BASE_URL}/develop/expert-enhancements-html.js)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### 📝 Testing Instructions" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. Copy the embed script above" >> $GITHUB_STEP_SUMMARY
          echo "2. Add it to the \`<head>\` of your CXone Expert site" >> $GITHUB_STEP_SUMMARY
          echo "3. Refresh the page to see the CSS editor toggle button" >> $GITHUB_STEP_SUMMARY
          echo "4. Test the latest development features!" >> $GITHUB_STEP_SUMMARY
